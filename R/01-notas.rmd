---
title: "01-notas"
author: "Joel Rodriguez Herrera (joelrh-lcg)"
output: html_document
---

# Clase martes 23 de febrero

Para crear proyecto:
```{r}
#usethis::create_project("/path/newProject")
```
Para crear archivo setup:
```{r}
#usethis::use_r('01-notas')
```

## Discusión en equipo sobre paquetes de Bioconductor

La mayoría de los paquetes son muy recientes y con descargar insuficientes para determinar todos los posibles errores que puedan surgir a la hora de usarlos. Suelen tener documentación suficiente para documentar su uso, pero podrían no cubrir situaciones no previstas. Aunque sí se ven varias opciones de contacto, encontramos uno que no tiene contacto ni forma de aclarar. Por ser tan recientes, se espera que no requieran tener tantas actualizaciones; sin embargo, encontramos paquetes donde GitHub mostraba que faltaban actualizaciones. 

Todos los paquetes analizados, todos parecen funcionar en todos los sitemas operativos. 

El paquete elegido fue: GWENA

En todos los demás había la posibilidad de comentar en Issues de GitHub, pero fue el único donde había errores comentados y resueltos. El autor@ contestó a los 3 días, lo cual parece muy buena atención y disposición de ayudar. Desde el Overview y documentación, con figuras y recursos gráficos se ve la dedicación que le da a que se entienda la teoría del paquete y la parte técnica de su funcionamiento. 

Tiene más descargar que los demás paquetes e interacción. Además, es el más actualizado.

# Clase miercoles 24 de febrero

```{r}
library("SummarizedExperiment")

## De los ejemplos en la ayuda oficial

## Creamos los datos para nuestro objeto de tipo SummarizedExperiment
## para 200 genes a lo largo de 6 muestras
nrows <- 200
ncols <- 6

## Números al azar de cuentas
set.seed(20210223)
counts <- matrix(runif(nrows * ncols, 1, 1e4), nrows)

## Información de nuestros genes
rowRanges <- GRanges(
  rep(c("chr1", "chr2"), c(50, 150)),
  IRanges(floor(runif(200, 1e5, 1e6)), width = 100),
  strand = sample(c("+", "-"), 200, TRUE),
  feature_id = sprintf("ID%03d", 1:200)
)
names(rowRanges) <- paste0("gene_", seq_len(length(rowRanges)))

## Información de nuestras muestras
colData <- DataFrame(
  Treatment = rep(c("ChIP", "Input"), 3),
  row.names = LETTERS[1:6]
)

## Juntamos ahora toda la información en un solo objeto de R
rse <- SummarizedExperiment(
  assays = SimpleList(counts = counts),
  rowRanges = rowRanges,
  colData = colData
)

## Exploremos el objeto resultante
rse

## Número de genes y muestras
dim(rse)

## IDs de nuestros genes y muestras
dimnames(rse)

## Nombres de tablas de cuentas que tenemos (RPKM, CPM, counts, logcounts, etc)
assayNames(rse)

## El inicio de nuestra tabla de cuentas
head(assay(rse))

## Información de los genes en un objeto de Bioconductor
rowRanges(rse)

## Ver los "unique" levels (cromosomas)
seqlevels(rse)
## Tabla comprimida por repetición de cada level (chromosoma)
seqnames(rowRanges(rse))

## Tabla con información de los genes
rowData(rse) # es idéntico a 'mcols(rowRanges(rse))'

## Tabla con información de las muestras
colData(rse)
```


## Ejercicio


Explica que sucede en las siguientes líneas de código de R.

```{r}
## Comando 1
rse[1:2, ]
head(assay(rse[1:2, ]))
```

*Explicación:*
Solo se muestran los primeros 2 genes, para esto se accesa a la tabla de 
rowData y a las tablas de assays para asegurarse de solo mostrar los 
renglones correspondientes

```{r}
## Comando 2
rse[, c("A", "D", "F")]
head(assay(rse[, c("A", "D", "F")]))
#tras bambalinas
which(colnames(rse)%in%c("A", "D", "F"))
```

*Explicación:*
Como las columnas son muestras, aquí accesamos a un subset con las primeras tres.
Para esto se accesa a la tabla colData para accesar a las muestras indicadas.

## ISEE: interactivo

```{r}
## Explora el objeto rse de forma interactiva
library("iSEE")
iSEE::iSEE(rse)
```


```{r}
## Descarguemos unos datos de spatialLIBD
sce_layer <- spatialLIBD::fetch_data("sce_layer")
```

```{r}
iSEE::iSEE(sce_layer)
```

```{r}
rowData(sce_layer)[2,]
```


## Recount

```{r}
library("recount3")
```

```{r}
## Revisemos todos los proyectos con datos de humano en recount3
human_projects <- available_projects()
```


```{r}
## Encuentra tu proyecto de interés. Aquí usaremos
## SRP009615 de ejemplo

proj_info <- subset(
    human_projects,
    project == "SRP009615" & project_type == "data_sources"
)
```

```{r}
# Crea un objetio de tipo RangedSummarizedExperiment (RSE)
## con la información a nivel de genes
rse_gene_SRP009615 <- create_rse(proj_info)
```

```{r}
rse_gene_SRP009615
```

```{r}
assay(rse_gene_SRP009615, "counts") <- compute_read_counts(rse_gene_SRP009615)
rse_gene_SRP009615
```

```{r}
rse_gene_SRP009615 <- expand_sra_attributes(rse_gene_SRP009615)
colData(rse_gene_SRP009615)[
    ,
    grepl("^sra_attribute", colnames(colData(rse_gene_SRP009615)))
]
```


```{r}
iSEE::iSEE(rse_gene_SRP009615)
```



